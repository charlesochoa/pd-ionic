{"version":3,"sources":["webpack:///src/app/modules/checkout/class/cart.ts","webpack:///src/app/modules/checkout/checkout.page.ts","webpack:///src/app/modules/checkout/checkout.page.html","webpack:///src/app/modules/checkout/checkout.module.ts","webpack:///src/app/modules/checkout/checkout.page.scss"],"names":["Cart","pk","creation_date","cart_products","ddp_user","subtotal","subtotalSinIva","delivery","discounts","iva","CheckoutPage","checkoutService","authService","alertController","toastController","router","user","cart","cartProducts","delay","getLocalUser","then","u","console","log","cartPk","getCart","subscribe","c","calculateCart","err","navigate","total","event","index","cartProduct","count","splice","create","cssClass","header","message","buttons","text","role","handler","blah","makeTransaction","t","duration","toast","set","clear","present","color","alert","selector","template","CheckoutPageModule","imports","forChild","path","component","declarations"],"mappings":"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","file":"modules-checkout-checkout-module-es5.js","sourcesContent":["import { Product } from \"../../menu/class/product\";\r\nimport { CartProduct } from \"./cart-product\";\r\nimport { User } from \"./user\";\r\n\r\nexport class Cart {\r\n  pk?: string;\r\n  creation_date?: Date;\r\n  cart_products?: CartProduct[];\r\n  ddp_user?: User;\r\n  subtotal?: number;\r\n  subtotalSinIva?: number;\r\n  delivery?: number;\r\n  discounts?: number;\r\n  iva?: number;\r\n  total?: number;\r\n\r\n  constructor() {\r\n    this.pk = \"\";\r\n    this.creation_date = null;\r\n    this.cart_products = [];\r\n    this.ddp_user = null;\r\n    this.subtotal = 0;\r\n    this.subtotalSinIva = 0;\r\n    this.delivery = 2.5;\r\n    this.discounts = 0.3;\r\n    this.iva = 0.21;\r\n  }\r\n}\r\n","import { Component, OnInit } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { AlertController, ToastController } from '@ionic/angular';\nimport { AuthService } from '../login/auth.service';\nimport { CheckoutService } from './checkout.service';\nimport { Cart } from './class/cart';\nimport { CartProduct } from './class/cart-product';\nimport { User } from './class/user';\n\n@Component({\n  selector: 'app-checkout',\n  templateUrl: 'checkout.page.html',\n  styleUrls: ['checkout.page.scss']\n})\nexport class CheckoutPage {\n  user: User = null;\n  cart: Cart = new Cart();\n  cartProducts: CartProduct[] = [];\n  delay = true;\n  constructor(private checkoutService: CheckoutService,\n    private authService: AuthService,\n    private alertController: AlertController,\n    public toastController: ToastController,\n    private router: Router\n    ) {}\n  ionViewWillEnter(): void {\n    this.authService.getLocalUser().then(u => {\n      this.user = u;\n      console.log(this.user);\n      if (this.user.cartPk) {\n        this.checkoutService.getCart(this.user.cartPk).subscribe( c => {\n          this.cart.subtotal = c.subtotal;\n          this.cart.pk = c.pk;\n          this.calculateCart();\n          this.cartProducts = c.cart_products;\n          this.delay = false;\n        })\n      }\n    },\n    err => {\n      this.router.navigate(['']);\n    });\n  }\n  ionViewDidLeave(): void {\n    this.cartProducts = [];\n    this.cart = new Cart();\n    this.delay = true;\n  }\n\n  calculateCart() {\n    const iva = 0.21;\n    const discounts = 0.3;\n    const delivery = 2.5;\n    if (this.cart.subtotal > 0 ) {\n      this.cart.subtotalSinIva = this.cart.subtotal - this.cart.subtotal * iva;\n      this.cart.iva = this.cart.subtotal * iva;\n      this.cart.discounts = this.cart.subtotal * discounts * (-1.0);\n      this.cart.delivery = delivery;\n      this.cart.total = this.cart.subtotal - discounts * (-1.0) + delivery;\n    } else {\n      this.cart.subtotalSinIva = 0;\n      this.cart.iva = 0;\n      this.cart.discounts = 0;\n      this.cart.delivery = 0;\n      this.cart.total = 0;\n    }\n  }\n\n  modifyCart(event: any, index: number) {\n    this.cart.subtotal = event.cart.subtotal;\n    this.cart.pk = event.cart.pk;\n    if(event.cartProduct && event.cartProduct.count > 0) {\n      this.cartProducts[index].count = event.cartProduct.count;\n    } else {\n      this.cartProducts.splice(index, 1);\n    }\n    this.calculateCart();\n  }\n\n  async submit() {\n    const alert = await this.alertController.create({\n      cssClass: 'my-custom-class',\n      header: 'Ya estás casi listo!',\n      message: `¿Seguro que deseas realizar esta compra por un total de <strong>${this.cart.total} €</strong>?`,\n      buttons: [\n        {\n          text: 'Todavía no',\n          role: 'cancel',\n          cssClass: 'secondary',\n          handler: (blah) => {\n          }\n        }, {\n          text: 'Seguro!',\n          handler: () => {\n            this.checkoutService.makeTransaction( this.cart.pk).subscribe(async t => {\n              const toast = await this.toastController.create({\n                message: `¡Prueba finalizada! <strong>¡Muchisimas gracias!</strong> revisa tu correo y en cuanto puedas nos comentas qué tal te pareció nuestra propuesta!`,\n                duration: 10000,\n              });\n              this.authService.set('t',t.pk);\n              await this.authService.clear();\n              toast.present();\n              this.router.navigate(['login']);\n            }, async err => {\n              const toast = await this.toastController.create({\n                message: 'Estamos teniendo problemas técnicos. Por favor, intente nuevamente.',\n                duration: 1000,\n                color: 'danger'\n              });\n              toast.present();\n            });\n          }\n        }\n      ]\n    });\n\n    alert.present();\n  }\n}\n","export default \"<ion-header background=\\\"danger\\\">\\n  <ion-toolbar>\\n      <ion-title slot=\\\"start\\\">\\n        <img\\n            src=\\\"../../../assets/images/icon.jpg\\\" height=\\\"40px\\\"\\n          />\\n      </ion-title>\\n    <ion-title slot=\\\"start\\\">\\n        <img\\n            src=\\\"../../../assets/images/letters.png\\\" height=\\\"20px\\\"\\n          />\\n    </ion-title>\\n  </ion-toolbar>\\n</ion-header>\\n\\n\\n<ion-content [fullscreen]=\\\"true\\\">\\n  <ion-header collapse=\\\"condense\\\">\\n    <ion-toolbar>\\n      <ion-title size=\\\"large\\\">Checkout</ion-title>\\n    </ion-toolbar>\\n  </ion-header>\\n  <ion-list *ngIf=\\\"cartProducts\\\" lines=\\\"none\\\">\\n    <ion-item-group>\\n      <ion-item-divider>\\n        <ion-label>Resumen de compra</ion-label>\\n      </ion-item-divider>\\n      <list-item *ngFor=\\\"let item of cartProducts; let i = index\\\"\\n        (cartChange)=\\\"modifyCart($event, i)\\\"\\n        [cartProduct]= \\\"item\\\"\\n        [cart]= \\\"cart\\\"\\n        class=\\\"item animated delay-0{{ i+3 }}s\\\"\\n        [angularShape]=\\\"user.angularShape\\\">\\n      </list-item>\\n      <ion-item lines=\\\"none\\\" *ngIf=\\\"cartProducts.length==0\\\" class=\\\"item animated delay-0{{ 3 }}s\\\">\\n        <label color=\\\"light\\\" class=\\\"summary-label\\\" slot=\\\"primary\\\">Aún no has agregado ninguna pizza al carrito.</label>\\n      </ion-item>\\n    </ion-item-group>\\n  </ion-list>\\n\\n</ion-content>\\n<ion-footer *ngIf=\\\"cart && !delay\\\">\\n  <ion-item-group>\\n    <ion-item-divider>\\n      <ion-label>Subtotal</ion-label>\\n    </ion-item-divider>\\n    <ion-item lines=\\\"none\\\">\\n\\n      <ion-label>Subtotal productos</ion-label>\\n      <ion-label class=\\\"summary-label\\\">{{cart.subtotal | number: '1.0-2'}} €</ion-label>\\n    </ion-item>\\n    <ion-item lines=\\\"none\\\">\\n\\n      <ion-label>IVA</ion-label>\\n      <ion-label class=\\\"summary-label\\\">{{cart.iva | number: '1.0-2'}} €</ion-label>\\n    </ion-item>\\n    <ion-item lines=\\\"none\\\">\\n      <ion-label color=\\\"success\\\">Descuentos</ion-label>\\n      <ion-label class=\\\"summary-label\\\" color=\\\"success\\\">{{cart.discounts | number: '1.0-2'}} €</ion-label>\\n    </ion-item>\\n\\n    <ion-item lines=\\\"none\\\">\\n      <ion-label>Envío</ion-label>\\n      <ion-label class=\\\"summary-label\\\">{{cart.delivery }} €</ion-label>\\n    </ion-item>\\n\\n    <ion-item lines=\\\"none\\\">\\n      <ion-label><strong>TOTAL</strong></ion-label>\\n      <ion-label class=\\\"summary-label\\\"><strong>{{ cart.total | number: '1.0-2'}} €</strong></ion-label>\\n    </ion-item>\\n    <ion-button *ngIf=\\\"user\\\"\\n      [style.color]=\\\"secondary\\\"\\n      [style.border]=\\\"secondary\\\"\\n      expand=\\\"block\\\"\\n      [class.rounded-shape]=\\\"!user.angularShape\\\" [class.angular-shape]=\\\"user.angularShape\\\"\\n      (click)=\\\"submit()\\\"\\n      >\\n      Realizar el Pago y a Disfrutar!\\n    </ion-button>\\n  </ion-item-group>\\n\\n</ion-footer>\\n\";","import { IonicModule } from '@ionic/angular';\nimport { RouterModule } from '@angular/router';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { CheckoutPage } from './checkout.page';\nimport { SharedModule } from '../../shared.module';\n\n\n@NgModule({\n  imports: [\n    IonicModule,\n    CommonModule,\n    FormsModule,\n    SharedModule,\n    RouterModule.forChild([{ path: '', component: CheckoutPage }])\n  ],\n  declarations: [CheckoutPage]\n})\nexport class CheckoutPageModule {}\n","export default \"ion-header ion-toolbar {\\n  --background: var(--ion-color-danger);\\n}\\n\\n.item {\\n  display: block;\\n  cursor: pointer;\\n  -webkit-animation-name: fadeInUp;\\n  animation-name: fadeInUp;\\n}\\n\\n.angular-shape {\\n  --border-radius: 0px ;\\n  border-radius: 0px;\\n}\\n\\n.rounded-shape {\\n  --border-radius: 40px ;\\n  border-radius: 40px;\\n}\\n\\n.summary-label {\\n  text-align: right;\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uXFwuLlxcLi5cXC4uXFxjaGVja291dC5wYWdlLnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBR0U7RUFDRSxxQ0FBQTtBQUZKOztBQU1BO0VBQ0UsY0FBQTtFQUNBLGVBQUE7RUFDQSxnQ0FBQTtFQUNBLHdCQUFBO0FBSEY7O0FBTUE7RUFDRSxxQkFBQTtFQUNBLGtCQUFBO0FBSEY7O0FBTUE7RUFDRSxzQkFBQTtFQUNBLG1CQUFBO0FBSEY7O0FBTUE7RUFDRSxpQkFBQTtBQUhGIiwiZmlsZSI6ImNoZWNrb3V0LnBhZ2Uuc2NzcyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5cclxuaW9uLWhlYWRlciB7XHJcbiAgaW9uLXRvb2xiYXIge1xyXG4gICAgLS1iYWNrZ3JvdW5kOiB2YXIoLS1pb24tY29sb3ItZGFuZ2VyKTtcclxuICB9XHJcbn1cclxuXHJcbi5pdGVtIHtcclxuICBkaXNwbGF5OiBibG9jaztcclxuICBjdXJzb3I6IHBvaW50ZXI7XHJcbiAgLXdlYmtpdC1hbmltYXRpb24tbmFtZTogZmFkZUluVXA7XHJcbiAgYW5pbWF0aW9uLW5hbWU6IGZhZGVJblVwO1xyXG59XHJcblxyXG4uYW5ndWxhci1zaGFwZSB7XHJcbiAgLS1ib3JkZXItcmFkaXVzOiAwcHggO1xyXG4gIGJvcmRlci1yYWRpdXM6IDBweCA7XHJcbn1cclxuXHJcbi5yb3VuZGVkLXNoYXBlIHtcclxuICAtLWJvcmRlci1yYWRpdXM6IDQwcHggO1xyXG4gIGJvcmRlci1yYWRpdXM6IDQwcHggO1xyXG59XHJcblxyXG4uc3VtbWFyeS1sYWJlbCB7XHJcbiAgdGV4dC1hbGlnbjogcmlnaHQ7XHJcbn1cclxuIl19 */\";"]}